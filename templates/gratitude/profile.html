{% extends 'base.html' %}
{% load i18n %}
{% load extras %}

{% block title %}{% trans 'Express Your Gratitude!' %}{% endblock %}
{% block content_title %}<h2 class="content-title">{% trans 'Express Your Gratitude!' %}</h2>{% endblock %}

{% block content %}

<div id="fb-root"></div>
<script>
      function publish1(gratitudeTextId, gratitudeDateId) {
         var gratitudeDate = document.getElementById(gratitudeDateId).textContent; 
         var gratitudeText = document.getElementById(gratitudeTextId).textContent; 
         var obj = {
            method: 'feed',
            display: 'popup',
            name: gratitudeText,
            caption: 'My gratitude for ' + gratitudeDate,
            description: 'From artofgratitude.com &mdash; a free site for cultivating the daily practice of gratitude.',
            link: '{{base_url}}',
            picture: '{{media_url}}/img/art_of_gratitude_leaf_large_square-128x128.png'
         };

        function callback(response) {
        }

         FB.ui(obj, callback);
      }
</script>

<div class="profile-preferences">
      <a href="{{site_prefix}}/accounts/{{ user.username }}">Preferences</a> 
</div>
<div class="row">
   <div class="span9">
      <h2 class="profile-header">{{ user.first_name }} {{ user.last_name }} - Your Gratitudes</h2>
      <p/>
      <ol reversed start="{{gratitudes_length}}">
         {% if form_fields|length > 0 %}
            <p/>
            <p class="profile-text profile-item"><i>{% trans "Enter your gratitudes for today in the boxes below (remember to start with 'I'm grateful for...'):" %}</i><p/>
            <br>
            <form action="{{ site_prefix }}/profile/{{ user.username }}" method="post">
               {% for field in form_fields %}
               {{ field }}<br>
               {% endfor %}
                  <input class="btn btn-primary" type="submit" value="Save your gratitudes!"/>
            </form>
         {% endif %}
         {% for group in gratitudes %}
            <div class="well">
               <div class="profile-text profile-day">
                  <i><div id="gratitude-date-{{forloop.counter}}">{{group.0.created|date:"l, F jS, Y"}}</div></i>
               </div>
               {% for gratitude in group %}
                  <div class="row-fluid">
                     <div class="profile-item">
                        <div class="span12">
                           <li class="profile-text" value="{{gratitude.listValue}}">
                              <span id="gratitude-text-{{forloop.parentloop.counter}}-{{forloop.counter}}">{{ gratitude.text }}</span> 
                              <span class="pull-right {% if forloop.parentloop.counter > 1 %}profile-hidden{% endif %}"><input id="gratitude-fbshare-{{forloop.parentloop.counter}}-{{forloop.counter}}" type="image" src="{{site_prefix}}/media/img/fb-share.png" class="profile-fb-share" alt="Post to Facebook" onclick="publish1('gratitude-text-{{forloop.parentloop.counter}}-{{forloop.counter}}','gratitude-date-{{forloop.parentloop.counter}}')" /></span>
                           </li>
                        </div>
                     </div>
                  </div>
               {% endfor %}
            </div>
         {% endfor %}
         </ol>
      <p/>
      {% if form_fields|length <= 0 %}
         <p class="profile-text profile-item"><i>{% trans "Look for your daily gratitude email in your inbox tomorrow!" %}</i><p/>
      {% endif %}
   </div> 
   <div class="span3"></div>
</div>
{% endblock %}
{% block content-footer %}
{% endblock %}
{% block javascript %}
   <script>
      window.fbAsyncInit = function() {
        console.log('Initializing Facebook SDK...');
        FB.init({appId: '{{facebook_app_id}}', status: true, cookie: true,
                 xfbml: true});
        console.log('Facebook init done.');
      };
      (function() {
        var e = document.createElement('script'); e.async = true;
        e.src = document.location.protocol +
          '//connect.facebook.net/en_US/all.js';
        document.getElementById('fb-root').appendChild(e);
      }());
   </script>
{% endblock %}
